% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spectral_analysis.R
\name{find_peaks}
\alias{find_peaks}
\title{Identify dominant spectral peaks by prominence}
\usage{
find_peaks(
  power_tbl,
  prominence = 100,
  min_separation_hr = NULL,
  min_period_hr = NULL,
  max_period_hr = NULL,
  n_peaks = 20L
)
}
\arguments{
\item{power_tbl}{A tibble from \code{\link{compute_power}()}.}

\item{prominence}{Numeric: minimum ratio of peak PSD to median PSD.
Default 100.}

\item{min_separation_hr}{Numeric or NULL: minimum period separation
(hours) between retained peaks. Default NULL (no separation filter).}

\item{min_period_hr}{Numeric or NULL: discard peaks with period below
this value (hours). Useful for ignoring high-frequency noise.}

\item{max_period_hr}{Numeric or NULL: discard peaks with period above
this value (hours).}

\item{n_peaks}{Integer: maximum number of peaks to return. Default 20.}
}
\value{
A tibble with the same columns as \code{compute_power()} output
  plus:
  \describe{
    \item{amplitude}{Estimated amplitude (signal units, e.g. degrees C)
      computed from PSD and frequency resolution.}
  }
  Rows are ordered by decreasing PSD (strongest peak first).
}
\description{
Finds local maxima in a power spectrum that exceed a prominence
threshold (multiple of the median spectral power). Returns peaks
ranked by power, with amplitude computed from the PSD-to-amplitude
relationship for a pure cosine.
}
\details{
**Prominence threshold:** A peak must exceed \code{prominence} times
the median PSD to be retained. Higher values yield fewer, more
confident peaks. For typical stream temperature spectra,
\code{prominence = 100} (default) captures the diel and seasonal
peaks while suppressing noise. Increase to 1000+ for very clean
signals; decrease to 10-50 for weak or noisy records.

**Minimum separation:** When \code{min_separation_hr} is specified,
peaks are selected greedily from strongest to weakest, rejecting any
candidate within \code{min_separation_hr} hours of an already-selected
peak. This prevents multiple adjacent bins around a single true peak
from appearing as separate detections.

**Amplitude interpretation:** The amplitude column converts PSD back
to signal amplitude. For a pure cosine of amplitude A, the PSD peak
equals A^2 / (2 * df) where df is the frequency resolution. The
amplitude column computes \code{sqrt(psd * df * 2)} accordingly.
For broad peaks (energy spread across bins due to non-stationarity
or windowing), the reported amplitude is a lower bound.
}
\examples{
\dontrun{
# Find dominant frequencies in a stream temperature record
spectrum <- stream_zoo \%>\% compute_power()
peaks <- spectrum \%>\% find_peaks(min_separation_hr = 2)
print(peaks)

# Focus on the diel band (6-48 hours)
diel_peaks <- spectrum \%>\%
  find_peaks(min_period_hr = 6, max_period_hr = 48, prominence = 50)
}

}
\references{
Shumway, R. H., & Stoffer, D. S. (2017). Time Series Analysis and
Its Applications (4th ed.), Chapter 4. Springer.
}
