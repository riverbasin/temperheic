% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spectral_analysis.R
\name{compute_power}
\alias{compute_power}
\title{Compute power spectral density of a temperature time series}
\usage{
compute_power(x, window = c("none", "hann"), detrend = FALSE)
}
\arguments{
\item{x}{A zoo object. Single-column or multi-column (one per sensor).
Index must be numeric (seconds) â€” the standard temperheic convention.}

\item{window}{Character: window function to apply before FFT. One of
\code{"none"} (default, rectangular window) or \code{"hann"} (Hann
window, reduces spectral leakage). The Hann window is recommended when
the record length is not an integer multiple of the target period.}

\item{detrend}{Logical: if \code{TRUE}, subtract a linear trend before
computing the spectrum. Default \code{FALSE}. Use this when the signal
has a strong non-periodic drift that would leak energy across all
frequencies. For temperature data where you want to see the annual peak,
leave this \code{FALSE}; for examining diel structure in a short window
with residual seasonal curvature, set to \code{TRUE}.}
}
\value{
A tibble with columns:
  \describe{
    \item{frequency_hz}{Numeric: frequency in Hz (cycles per second).}
    \item{period_s}{Numeric: period in seconds (1 / frequency_hz).}
    \item{period_hr}{Numeric: period in hours.}
    \item{period_day}{Numeric: period in days.}
    \item{psd}{Numeric: power spectral density (amplitude^2 / Hz).}
    \item{series}{Character: column name from input zoo object. Present
      for all inputs (single-column zoo objects use the column name or
      \code{"value"} if unnamed).}
  }
  Rows are sorted by increasing frequency. Only positive frequencies
  are returned (DC and Nyquist components are excluded).
}
\description{
Estimates the power spectral density (PSD) of a zoo time series using the
periodogram method (base FFT). Returns a tidy tibble for pipe-friendly
exploration and ggplot-ready visualization. This is the exploratory
complement to \code{\link{fit_ols}} and \code{\link{fit_fft}}: use
\code{compute_power()} to survey what frequencies are present in a signal,
then use the fitting functions to extract amplitude and phase at specific
target frequencies.
}
\details{
**Method:** The function computes a standard periodogram via \code{stats::fft()}.
The input is mean-centered (DC removed) before transforming. An optional
Hann window can be applied to reduce spectral leakage from non-integer
periodicities, at the cost of ~1.5x broadening of spectral peaks.

**Normalization:** Power is normalized as power spectral density (PSD)
with units of amplitude\eqn{^2} / Hz, computed as
\eqn{2 |X_k|^2 / (N \cdot f_s)} where \eqn{f_s} is the sampling
frequency. The factor of 2 accounts for the one-sided spectrum (positive
frequencies only). When \code{window = "hann"}, an additional correction
factor compensates for the windowing energy loss. PSD values are
comparable across records of different lengths and sampling rates.

**NA handling:** NAs are filled by linear interpolation
(\code{zoo::na.approx}); remaining edge NAs are replaced with the series
mean. A warning is issued if more than 10\% of values are NA.

**Multi-column zoo objects:** When \code{x} has multiple columns (e.g.,
multiple sensor depths), spectra are computed independently for each
column and returned as a single long-format tibble with a \code{series}
column identifying the source.

**Interpreting the output:** The key columns for exploration are
\code{period_hr} (or \code{period_day}) and \code{psd}. Plot these on
log-log axes to identify dominant periodicities. In temperature data,
expect peaks near 24 hr (diel), 12 hr (semi-diurnal), and 8766 hr
(annual, if the record is long enough). The relative magnitude of the
diel peak across depths is a first-order indicator of signal attenuation
and thus subsurface thermal transport.
}
\examples{
\dontrun{
# Survey the spectrum of a stream temperature record
stream_psd <- stream_zoo \%>\% compute_power()

# Log-log plot of power spectrum
library(ggplot2)
ggplot(stream_psd, aes(period_hr, psd)) +
  geom_line() +
  scale_x_log10() + scale_y_log10() +
  geom_vline(xintercept = c(12, 24, 8766), lty = 2, alpha = 0.5) +
  labs(x = "Period (hours)", y = "PSD")

# Compare spectra across sensor depths
multi_psd <- multi_sensor_zoo \%>\% compute_power(window = "hann")
ggplot(multi_psd, aes(period_hr, psd, color = series)) +
  geom_line() +
  scale_x_log10() + scale_y_log10()
}

}
\references{
Shumway, R. H., & Stoffer, D. S. (2017). Time Series Analysis and Its
Applications (4th ed.). Springer. Chapter 4: Spectral Analysis and Filtering.

Luce, C. H., & Tonina, D. (2017). Modeling of streambed surface and
hyporheic temperatures. In D. Tonina (Ed.), Open Channel Hydraulics,
River Hydraulic Structures and Fluvial Geomorphology. CRC Press.
}
