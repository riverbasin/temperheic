% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/signal_processing.R
\name{detrend_temperature}
\alias{detrend_temperature}
\title{Remove trend from a temperature time series}
\usage{
detrend_temperature(
  x,
  method = c("loess", "ma", "polynomial"),
  span = 0.05,
  window = 24L,
  degree = 2L,
  return_trend = FALSE
)
}
\arguments{
\item{x}{A zoo object. Single-column or multi-column (one per sensor).}

\item{method}{Character: detrending method. One of "loess" (default),
"ma" (moving average), or "polynomial".}

\item{span}{Numeric: loess smoothing span as fraction of data (0, 1].
Default 0.05. Only used when `method = "loess"`.}

\item{window}{Integer: moving average window width in observations.
Default 24 (one day at hourly sampling). Only used when `method = "ma"`.}

\item{degree}{Integer: polynomial degree. Default 2. Only used when
`method = "polynomial"`.}

\item{return_trend}{Logical: if TRUE, return a list with both the
detrended series and the estimated trend. Default FALSE (returns
only the detrended zoo object for pipe-friendly use).}
}
\value{
If `return_trend = FALSE` (default): a zoo object of the same
  structure as `x`, containing the detrended (residual) series.
  If `return_trend = TRUE`: a list with components `detrended` (zoo)
  and `trend` (zoo), both matching the structure of `x`.
}
\description{
Estimates and subtracts a slowly-varying trend component, isolating the
oscillatory signal (diel, seasonal, or other periodic component) for
subsequent amplitude/phase extraction. The trend is typically the annual
cycle when targeting diel signals, or a multi-year drift when targeting
seasonal signals.
}
\details{
Three detrending methods are available:

**loess** (default): Local polynomial regression via `stats::loess()`.
  The `span` parameter controls the smoothing bandwidth as a fraction of
  the data. Smaller span = more flexible trend. A span of ~0.05-0.1
  captures seasonal variation in a year-long record while preserving
  diel oscillations. This is the most flexible method and generally
  the best default for field data with irregular trends.

**ma** (moving average): Centered running mean via `stats::filter()`.
  The `window` parameter specifies the width in number of observations.
  For hourly data targeting the diel cycle, a 24-point window (1 day)
  removes the diel signal and leaves the trend; a 168-point window
  (1 week) smooths both diel and synoptic variability. Edge values are
  NA; use `na.rm = TRUE` in downstream functions.

**polynomial**: Polynomial regression via `stats::lm()`. The `degree`
  parameter controls the polynomial order (1 = linear, 2 = quadratic,
  etc.). Best for records where the trend is approximately monotonic
  or gently curved. Avoids the edge effects of loess/ma but cannot
  capture complex seasonal patterns.

For multi-column zoo objects (multiple sensor depths), detrending is
applied independently to each column via `purrr::map()`.
}
\examples{
\dontrun{
# Remove seasonal trend from a year of hourly stream temperature
stream_detrended <- stream_temp \%>\%
  detrend_temperature(method = "loess", span = 0.05)

# Inspect both trend and residual
result <- stream_temp \%>\%
  detrend_temperature(method = "ma", window = 168, return_trend = TRUE)
plot(result$trend)
plot(result$detrended)
}

}
